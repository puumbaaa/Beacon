{"ast":null,"code":"// PostgreSQL Column Compiler\n// -------\n\nconst ColumnCompiler = require('../../../schema/columncompiler');\nconst {\n  isObject\n} = require('../../../util/is');\nconst {\n  toNumber\n} = require('../../../util/helpers');\nconst commentEscapeRegex = /(?<!')'(?!')/g;\nclass ColumnCompiler_PG extends ColumnCompiler {\n  constructor(client, tableCompiler, columnBuilder) {\n    super(client, tableCompiler, columnBuilder);\n    this.modifiers = ['nullable', 'defaultTo', 'comment'];\n    this._addCheckModifiers();\n  }\n\n  // Types\n  // ------\n\n  bit(column) {\n    return column.length !== false ? `bit(${column.length})` : 'bit';\n  }\n\n  // Create the column definition for an enum type.\n  // Using method \"2\" here: http://stackoverflow.com/a/10984951/525714\n  enu(allowed, options) {\n    options = options || {};\n    const values = options.useNative && options.existingType ? undefined : allowed.join(\"', '\");\n    if (options.useNative) {\n      let enumName = '';\n      const schemaName = options.schemaName || this.tableCompiler.schemaNameRaw;\n      if (schemaName) {\n        enumName += `\"${schemaName}\".`;\n      }\n      enumName += `\"${options.enumName}\"`;\n      if (!options.existingType) {\n        this.tableCompiler.unshiftQuery(`create type ${enumName} as enum ('${values}')`);\n      }\n      return enumName;\n    }\n    return `text check (${this.formatter.wrap(this.args[0])} in ('${values}'))`;\n  }\n  decimal(precision, scale) {\n    if (precision === null) return 'decimal';\n    return `decimal(${toNumber(precision, 8)}, ${toNumber(scale, 2)})`;\n  }\n  json(jsonb) {\n    if (jsonb) this.client.logger.deprecate('json(true)', 'jsonb()');\n    return jsonColumn(this.client, jsonb);\n  }\n  jsonb() {\n    return jsonColumn(this.client, true);\n  }\n  checkRegex(regex, constraintName) {\n    return this._check(`${this.formatter.wrap(this.getColumnName())} ~ ${this.client._escapeBinding(regex)}`, constraintName);\n  }\n  datetime(withoutTz = false, precision) {\n    let useTz;\n    if (isObject(withoutTz)) {\n      ({\n        useTz,\n        precision\n      } = withoutTz);\n    } else {\n      useTz = !withoutTz;\n    }\n    useTz = typeof useTz === 'boolean' ? useTz : true;\n    precision = precision !== undefined && precision !== null ? '(' + precision + ')' : '';\n    return `${useTz ? 'timestamptz' : 'timestamp'}${precision}`;\n  }\n  timestamp(withoutTz = false, precision) {\n    return this.datetime(withoutTz, precision);\n  }\n\n  // Modifiers:\n  // ------\n  comment(comment) {\n    const columnName = this.args[0] || this.defaults('columnName');\n    const escapedComment = comment ? `'${comment.replace(commentEscapeRegex, \"''\")}'` : 'NULL';\n    this.pushAdditional(function () {\n      this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.` + this.formatter.wrap(columnName) + ` is ${escapedComment}`);\n    }, comment);\n  }\n  increments(options = {\n    primaryKey: true\n  }) {\n    return 'serial' + (this.tableCompiler._canBeAddPrimaryKey(options) ? ' primary key' : '');\n  }\n  bigincrements(options = {\n    primaryKey: true\n  }) {\n    return 'bigserial' + (this.tableCompiler._canBeAddPrimaryKey(options) ? ' primary key' : '');\n  }\n  uuid(options = {\n    primaryKey: false\n  }) {\n    return 'uuid' + (this.tableCompiler._canBeAddPrimaryKey(options) ? ' primary key' : '');\n  }\n}\nColumnCompiler_PG.prototype.bigint = 'bigint';\nColumnCompiler_PG.prototype.binary = 'bytea';\nColumnCompiler_PG.prototype.bool = 'boolean';\nColumnCompiler_PG.prototype.double = 'double precision';\nColumnCompiler_PG.prototype.floating = 'real';\nColumnCompiler_PG.prototype.smallint = 'smallint';\nColumnCompiler_PG.prototype.tinyint = 'smallint';\nfunction jsonColumn(client, jsonb) {\n  if (!client.version || client.config.client === 'cockroachdb' || client.config.jsonbSupport === true || parseFloat(client.version) >= 9.2) {\n    return jsonb ? 'jsonb' : 'json';\n  }\n  return 'text';\n}\nmodule.exports = ColumnCompiler_PG;","map":{"version":3,"names":["ColumnCompiler","require","isObject","toNumber","commentEscapeRegex","ColumnCompiler_PG","constructor","client","tableCompiler","columnBuilder","modifiers","_addCheckModifiers","bit","column","length","enu","allowed","options","values","useNative","existingType","undefined","join","enumName","schemaName","schemaNameRaw","unshiftQuery","formatter","wrap","args","decimal","precision","scale","json","jsonb","logger","deprecate","jsonColumn","checkRegex","regex","constraintName","_check","getColumnName","_escapeBinding","datetime","withoutTz","useTz","timestamp","comment","columnName","defaults","escapedComment","replace","pushAdditional","pushQuery","tableName","increments","primaryKey","_canBeAddPrimaryKey","bigincrements","uuid","prototype","bigint","binary","bool","double","floating","smallint","tinyint","version","config","jsonbSupport","parseFloat","module","exports"],"sources":["C:/Users/momo1/Documents/@DevPerso/Beacon/node_modules/knex/lib/dialects/postgres/schema/pg-columncompiler.js"],"sourcesContent":["// PostgreSQL Column Compiler\n// -------\n\nconst ColumnCompiler = require('../../../schema/columncompiler');\nconst { isObject } = require('../../../util/is');\nconst { toNumber } = require('../../../util/helpers');\nconst commentEscapeRegex = /(?<!')'(?!')/g;\n\nclass ColumnCompiler_PG extends ColumnCompiler {\n  constructor(client, tableCompiler, columnBuilder) {\n    super(client, tableCompiler, columnBuilder);\n    this.modifiers = ['nullable', 'defaultTo', 'comment'];\n    this._addCheckModifiers();\n  }\n\n  // Types\n  // ------\n\n  bit(column) {\n    return column.length !== false ? `bit(${column.length})` : 'bit';\n  }\n\n  // Create the column definition for an enum type.\n  // Using method \"2\" here: http://stackoverflow.com/a/10984951/525714\n  enu(allowed, options) {\n    options = options || {};\n\n    const values =\n      options.useNative && options.existingType\n        ? undefined\n        : allowed.join(\"', '\");\n\n    if (options.useNative) {\n      let enumName = '';\n      const schemaName = options.schemaName || this.tableCompiler.schemaNameRaw;\n\n      if (schemaName) {\n        enumName += `\"${schemaName}\".`;\n      }\n\n      enumName += `\"${options.enumName}\"`;\n\n      if (!options.existingType) {\n        this.tableCompiler.unshiftQuery(\n          `create type ${enumName} as enum ('${values}')`\n        );\n      }\n\n      return enumName;\n    }\n    return `text check (${this.formatter.wrap(this.args[0])} in ('${values}'))`;\n  }\n\n  decimal(precision, scale) {\n    if (precision === null) return 'decimal';\n    return `decimal(${toNumber(precision, 8)}, ${toNumber(scale, 2)})`;\n  }\n\n  json(jsonb) {\n    if (jsonb) this.client.logger.deprecate('json(true)', 'jsonb()');\n    return jsonColumn(this.client, jsonb);\n  }\n\n  jsonb() {\n    return jsonColumn(this.client, true);\n  }\n\n  checkRegex(regex, constraintName) {\n    return this._check(\n      `${this.formatter.wrap(\n        this.getColumnName()\n      )} ~ ${this.client._escapeBinding(regex)}`,\n      constraintName\n    );\n  }\n\n  datetime(withoutTz = false, precision) {\n    let useTz;\n    if (isObject(withoutTz)) {\n      ({ useTz, precision } = withoutTz);\n    } else {\n      useTz = !withoutTz;\n    }\n    useTz = typeof useTz === 'boolean' ? useTz : true;\n    precision =\n      precision !== undefined && precision !== null\n        ? '(' + precision + ')'\n        : '';\n\n    return `${useTz ? 'timestamptz' : 'timestamp'}${precision}`;\n  }\n\n  timestamp(withoutTz = false, precision) {\n    return this.datetime(withoutTz, precision);\n  }\n\n  // Modifiers:\n  // ------\n  comment(comment) {\n    const columnName = this.args[0] || this.defaults('columnName');\n    const escapedComment = comment\n      ? `'${comment.replace(commentEscapeRegex, \"''\")}'`\n      : 'NULL';\n\n    this.pushAdditional(function () {\n      this.pushQuery(\n        `comment on column ${this.tableCompiler.tableName()}.` +\n          this.formatter.wrap(columnName) +\n          ` is ${escapedComment}`\n      );\n    }, comment);\n  }\n\n  increments(options = { primaryKey: true }) {\n    return (\n      'serial' +\n      (this.tableCompiler._canBeAddPrimaryKey(options) ? ' primary key' : '')\n    );\n  }\n\n  bigincrements(options = { primaryKey: true }) {\n    return (\n      'bigserial' +\n      (this.tableCompiler._canBeAddPrimaryKey(options) ? ' primary key' : '')\n    );\n  }\n\n  uuid(options = { primaryKey: false }) {\n    return (\n      'uuid' +\n      (this.tableCompiler._canBeAddPrimaryKey(options) ? ' primary key' : '')\n    );\n  }\n}\n\nColumnCompiler_PG.prototype.bigint = 'bigint';\nColumnCompiler_PG.prototype.binary = 'bytea';\nColumnCompiler_PG.prototype.bool = 'boolean';\nColumnCompiler_PG.prototype.double = 'double precision';\nColumnCompiler_PG.prototype.floating = 'real';\nColumnCompiler_PG.prototype.smallint = 'smallint';\nColumnCompiler_PG.prototype.tinyint = 'smallint';\n\nfunction jsonColumn(client, jsonb) {\n  if (\n    !client.version ||\n    client.config.client === 'cockroachdb' ||\n    client.config.jsonbSupport === true ||\n    parseFloat(client.version) >= 9.2\n  ) {\n    return jsonb ? 'jsonb' : 'json';\n  }\n  return 'text';\n}\n\nmodule.exports = ColumnCompiler_PG;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}